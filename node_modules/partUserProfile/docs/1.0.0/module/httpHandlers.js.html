<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <title>JSDoc: Source: httpHandlers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body><div class="details container"><b> Module: </b>appTemplate<br><b>Group: </b>module<br><b>File Path: </b>docs\1.0.0\module\</div><hr>

<div id="main">

    <h1 class="page-title">Source: httpHandlers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @namespace module.partUserProfile.httpHandlers
 */
const partUserProfile = require(&apos;partUserProfile&apos;)
const Q = require(&apos;q&apos;)
const rp = require(&apos;request-promise&apos;);
const uuid = require(&apos;uuid4&apos;);


//------------------------  SIGN UP  ----------------------- //ok
/**
 * @summary &#x62B;&#x628;&#x62A; &#x646;&#x627;&#x645; &#x6A9;&#x627;&#x631;&#x628;&#x631;
 * @description &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x62F;&#x627;&#x62F;&#x647; &#x647;&#x627;&#x6CC; &#x648;&#x631;&#x648;&#x62F;&#x6CC; &#x631;&#x627; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x6A9;&#x627;&#x631;&#x645;&#x646;&#x62F;&#x627;&#x646; - &#x633;&#x645;&#x62F; - &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x648; &#x627;&#x647;&#x631;&#x627;&#x632;&#x647;&#x648;&#x6CC;&#x62A; &#x648;&#x627;&#x631;&#x62F; &#x6A9;&#x631;&#x62F;&#x647; &#x648; &#x62F;&#x631;&#x635;&#x648;&#x631;&#x62A; &#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x6CC;&#x6A9; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x628;&#x647; &#x627;&#x6CC;&#x646; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x627;&#x636;&#x627;&#x641;&#x647; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
 * @param{!object} request
 * @param{!object} response
 * @param {!string} request.data.id &#x634;&#x646;&#x627;&#x633;&#x647;
 * @param{!object} data
 * @param {!string} request.data.data.username &#x646;&#x627;&#x645; &#x6A9;&#x627;&#x631;&#x628;&#x631;&#x6CC;
 * @param {!string} request.data.data.password &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631;
 * @param {!string} request.data.data.nationalCode &#x6A9;&#x62F;&#x645;&#x644;&#x6CC;
 * @param {!string} request.data.data.skill &#x645;&#x647;&#x627;&#x631;&#x62A;
 * @param {!string} request.data.data.job &#x634;&#x63A;&#x644;
 * @param {!string} request.data.data.managerName &#x646;&#x627;&#x645; &#x645;&#x62F;&#x6CC;&#x631;
 * @param {!string} request.data.data.firstName &#x646;&#x627;&#x645;
 * @param {!string} request.data.data.lastName &#x646;&#x627;&#x645; &#x62E;&#x627;&#x646;&#x648;&#x627;&#x62F;&#x6AF;&#x6CC;
 * @param {!string} request.data.data.gender &#x62C;&#x646;&#x633;&#x6CC;&#x62A;
 * @param {!string} request.data.data.education &#x62A;&#x62D;&#x635;&#x6CC;&#x644;&#x627;&#x62A;
 * @param {!string} request.data.parent &#x646;&#x627;&#x645; &#x67E;&#x62F;&#x631;
 *
 * @return{object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 *
 */

const signUp = exports.signUp = function (request, response) {
    console.log(&apos;-----------------sign up-------------------&apos;)

    var self = this;
    var auth = self._auth
    var profile = self._profile
    var samad = self._samad
    var res = []
    var errors = []

    let data = {
        type: &apos;real&apos;,
        id: request.data.id,
        username: request.data.data.username,
        password: request.data.data.password,
        idNumber: request.data.data.nationalCode,
        firstName: request.data.data.firstName,
        lastName: request.data.data.lastName,
        gender: request.data.data.gender,
        education: request.data.data.education,
    }

    let profileData = {
        type: &apos;real&apos;,
        uniqueKey: request.data.data.username,
        idNumber: request.data.data.nationalCode,
        firstName: request.data.data.firstName,
        lastName: request.data.data.lastName,
        gender: request.data.data.gender,
        education: request.data.data.education,
    };

    let authData = {
        username: request.data.data.username,
        password: request.data.data.password
    };


    Q.allSettled([
        auth.addUser(authData, &apos;active&apos;, &apos;intern_6&apos;, {&apos;request-id&apos;: uuid(), userIp: &apos;127.0.0.1&apos;}),
        self.employeeService(request, response),
        profile.addProfile(profileData, {&apos;request-id&apos;: uuid(), userIp: &apos;127.0.0.1&apos;}),
        samad.addUsers([request.data.data.username], &quot;intern_6&quot;, {&quot;request-id&quot;: uuid()})
            .then(samad.assignUsersToRole(&apos;manager&apos;, [request.data.data.username], &apos;intern_6&apos;, {&apos;request-id&apos;: uuid()}))
    ])
        .then(function (results) {
            var success = 0;
            results.forEach(function (result) {
                if (result.state === &quot;fulfilled&quot;) {

                        //&#x627;&#x6AF;&#x631; &#x62E;&#x631;&#x648;&#x62C;&#x6CC; &#x645;&#x631;&#x628;&#x648;&#x637; &#x628;&#x647; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x633;&#x645;&#x62F; &#x628;&#x627;&#x634;&#x62F; &#x634;&#x631;&#x638; &#x632;&#x6CC;&#x631; &#x627;&#x62C;&#x631;&#x627; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
                    if (Array.isArray(result.value.data)) {
                        if (result.value.data[0].status === &apos;Already exists!&apos;) {
                            errors.push(&quot;samad Already exists!&quot;)

                        } else if (result.value.data[0].status === &apos;ok&apos;) {
                            res.push(&apos;samad&apos;)
                            success++
                        }
                        //&#x627;&#x6AF;&#x631; &#x67E;&#x627;&#x633;&#x62E; &#x631;&#x628;&#x648;&#x637; &#x628;&#x647; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x6A9;&#x627;&#x631;&#x645;&#x646;&#x62F;&#x627;&#x646; &#x628;&#x627;&#x634;&#x62F; &#x634;&#x631;&#x638; &#x632;&#x6CC;&#x631; &#x627;&#x62C;&#x631;&#x627; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
                    } else if (result.value === &apos;&#x62F;&#x627;&#x62F;&#x647; &#x647;&#x627; &#x628;&#x627;&#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x630;&#x62E;&#x6CC;&#x631;&#x647; &#x634;&#x62F;data insert in dataStorage,data insert in dataMap&apos;) {
                        res.push(&apos;employee&apos;)
                        success++
                        //&#x627;&#x62C;&#x631;&#x627;&#x6CC; &#x62D;&#x627;&#x644;&#x62A; &#x635;&#x62D;&#x6CC;&#x62D; &#x645;&#x631;&#x628;&#x648;&#x637; &#x628;&#x647; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x647;&#x627;&#x6CC; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x648; &#x627;&#x647;&#x631;&#x627;&#x632; &#x647;&#x648;&#x6CC;&#x62A;
                    } else if (typeof result.value.data[0] === &apos;undefined&apos;) {
                        if (result.value.data.function === &apos;undefined&apos;) {
                            errors.push(&apos;invalid function&apos;)
                            // res.push(result.value)
                            // success++
                        } else {
                            res.push(result.value.data.function)
                            success++
                        }

                    }


                } else {
                    if (typeof result.reason.error.meta === &apos;undefined&apos;) {
                        errors.push(result.reason.error)
                    } else {
                        errors.push(result.reason.error.meta.code)
                    }

                }
            });
            console.log(success)
            if (success === 4) {
                response.sendOk(&apos;&#x62B;&#x628;&#x62A; &#x646;&#x627;&#x645; &#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x627;&#x645;&#x6CC;&#x632;&apos;)
            } else {

                res.forEach(function (deleteItem) {
                    if (deleteItem === &quot;auth&quot;) auth.removeUser({username: request.data.data.username}, &apos;intern_6&apos;, {
                        &apos;request-id&apos;: uuid(),
                        userIp: &apos;127.0.0.1&apos;
                    })
                    if (deleteItem === &quot;employee&quot;) self.removeEmployee(request, response)
                    if (deleteItem === &quot;samad&quot;) samad.removeUsers([request.data.data.username], request.headers.org, {&apos;request-id&apos;: uuid()})
                    if (deleteItem === &quot;profile&quot;) profile.removeProfileById(request.data.data.nationalCode, {
                        &apos;request-id&apos;: uuid(),
                        userIp: &apos;127.0.0.1&apos;
                    })
                })

                console.log(JSON.stringify(res))
                //response.sendFail(&apos;err&apos;)
                console.log(JSON.stringify(errors))
                response.sendFail(JSON.stringify(errors))
            }
        });

}

/**
 * @summary &#x62B;&#x628;&#x62A; &#x646;&#x627;&#x645; &#x62F;&#x631; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x6A9;&#x627;&#x631;&#x645;&#x646;&#x62F;&#x627;&#x646;
 * @description &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x62F;&#x627;&#x62F;&#x647; &#x647;&#x627;&#x6CC; &#x62F;&#x631;&#x6CC;&#x627;&#x641;&#x62A;&#x6CC; &#x631;&#x627; &#x62F;&#x631; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x6A9;&#x627;&#x631;&#x645;&#x646;&#x62F;&#x627;&#x646; &#x62B;&#x628;&#x62A; &#x645;&#x6CC;&#x6A9;&#x646;&#x62F;
 * @param {!object} request.data &#x62F;&#x631;&#x62E;&#x648;&#x627;&#x633;&#x62A;
 * @return {!object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 *
 */
exports.employeeService = function (request, response) {
    let deferred = Q.defer()
    const options = {
        url: &apos;http://localhost:81/dataService&apos;,
        method: &apos;PUT&apos;,
        headers: request.headers,
        body: {
            &quot;id&quot;: request.data.data.nationalCode,
            &quot;data&quot;: request.data.data,
            &quot;parent&quot;: request.data.parent
        },
        json: true
    }
    rp(options)
        .then(function (result) {
            console.log(&apos;add to employee&apos;)
            deferred.resolve(result)
        })
        .catch(function (error) {
            deferred.reject(error)
        })

    return deferred.promise;
}

//------------------------  LOGIN  -------------------------- //ok

/**
 * @summary &#x648;&#x631;&#x648;&#x62F; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x628;&#x647; &#x633;&#x6CC;&#x633;&#x62A;&#x645;
 * @description &#x62F;&#x631; &#x627;&#x6CC;&#x646; &#x62A;&#x627;&#x628;&#x639; &#x628;&#x639;&#x62F; &#x627;&#x632; &#x627;&#x647;&#x631;&#x627;&#x632; &#x647;&#x648;&#x6CC;&#x62A; &#x634;&#x62F;&#x646; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x628;&#x627; &#x646;&#x627;&#x645; &#x6A9;&#x631;&#x628;&#x631;&#x6CC; &#x648; &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631; &#x6CC;&#x6A9; &#x633;&#x634;&#x646; &#x648; &#x6CC;&#x6A9; &#x6A9;&#x648;&#x6A9;&#x6CC; &#x628;&#x631;&#x627;&#x6CC; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x627;&#x6CC;&#x62C;&#x627;&#x62F; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
 * @param {!object} request
 * @param {!object} response
 * @param {!string} request.data.username &#x646;&#x627;&#x645; &#x6A9;&#x627;&#x631;&#x628;&#x631;&#x6CC;
 * @param {!string} request.data.password &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631;
 * @return {!object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 */
exports.login = function (request, response) {
    console.log(&apos;--------------login-------------- &apos;)

    let self = this
    let auth = self._auth
    let samad = self._samad
    let profile = self._profile

    auth.authenticate(
        {username: request.data.username, password: request.data.password}, null, {
            &apos;request-id&apos;: uuid(),
            userIp: &apos;127.0.0.1&apos;
        }).then(setSessionByRole(request, response, samad, profile))
        .then(function (result) {
            response.sendOk(result)
        })
        .catch(function (error) {
            response.sendFail(error)
        })

}

/**
 * @summary &#x627;&#x6CC;&#x62C;&#x627;&#x62F; &#x633;&#x634;&#x646;
 * @description &#x646;&#x642;&#x634; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x627;&#x632; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x633;&#x645;&#x62F; &#x6AF;&#x631;&#x641;&#x62A;&#x647; &#x645;&#x6CC;&#x634;&#x648;&#x62F; &#x648; &#x647;&#x645;&#x631;&#x627;&#x647; &#x628;&#x627; &#x646;&#x627;&#x645; &#x6A9;&#x627;&#x631;&#x628;&#x631;&#x6CC; &#x62F;&#x627;&#x62E;&#x644; &#x6CC;&#x6A9; &#x633;&#x634;&#x646; &#x630;&#x62E;&#x6CC;&#x631;&#x647; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
 * @param {!object} request
 * @param {!string} request.data.username &#x646;&#x627;&#x645; &#x6A9;&#x627;&#x631;&#x628;&#x631;&#x6CC;
 * @param {!object} response &#x67E;&#x627;&#x633;&#x62E; &#x62F;&#x631;&#x62E;&#x648;&#x627;&#x633;&#x62A;
 * @param {!object} samad &#x6CC;&#x6A9; &#x646;&#x645;&#x648;&#x646;&#x647; &#x627;&#x632; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x633;&#x645;&#x62F;
 * @param {!object} profile &#x6CC;&#x6A9; &#x646;&#x645;&#x648;&#x646;&#x647; &#x627;&#x632; &#x633;&#x631;&#x648;&#x6CC;&#x633; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644;
 * @return {promise.&lt;*&gt;} response &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 */
function setSessionByRole(request, response, samad, profile) {


    samad.getUsersByUsername([request.data.username], &apos;intern_6&apos;, {&apos;request-id&apos;: uuid()})
        .then(function (result) {
            let data = {
                &apos;samadUsername&apos;: request.data.username,
                &apos;roles&apos;: result.data[0].roles
            }
            request.session.start(data, (err, res) =&gt; {
                if (err) {
                    return err
                } else {
                    response.setHeader(&apos;Set-Cookie&apos;, `token=${res.token};Path=/`);
                    return res
                }
            })
        })
        .catch(function (err) {
            return err
        })
}

exports.setSessionByRole = setSessionByRole;


//------------------------  LOGOUT  ------------------------- //ok
/**
 * @summary &#x62D;&#x630;&#x641; &#x633;&#x634;&#x646;
 * @description &#x628;&#x627; &#x641;&#x631;&#x627;&#x62E;&#x648;&#x627;&#x646;&#x6CC; &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x633;&#x634;&#x646; &#x645;&#x648;&#x62C;&#x648;&#x62F; &#x62D;&#x630;&#x641; &#x645;&#x6CC;&#x634;&#x648;&#x62F; &#x648; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x627;&#x632; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x62E;&#x627;&#x631;&#x62C; &#x645;&#x6CC;&#x634;&#x648;&#x62F;
 * @param {!object} request
 * @param {!object} response
 * @return{!object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 */
exports.logout = function (request, response) {

    console.log(&apos;----------------you call logout-----------------&apos;)

    request.session.remove(function (err, res) {
        if (err) {
            response.sendFail(err.message)
        } else {
            request.headers.cookie = null
            response.sendOk(&apos;&#x62E;&#x631;&#x648;&#x62C; &#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x627;&#x645;&#x6CC;&#x632;&apos;)
        }
    });
}

//------------------------  CHANGE_PASS  --------------------- //ok

/**
 * @summary &#x62A;&#x63A;&#x6CC;&#x6CC;&#x631; &#x631;&#x645;&#x632; &#x639;&#x628;&#x648;&#x631;
 * @description &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x628;&#x627; &#x62F;&#x631;&#x6CC;&#x627;&#x641;&#x62A; &#x6A9;&#x62F;&#x645;&#x644;&#x6CC; - &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631; &#x62C;&#x62F;&#x6CC;&#x62F; - &#x627;&#x6CC;&#x645;&#x6CC;&#x644; &#x648; &#x646;&#x648;&#x639; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x62F;&#x631;&#x635;&#x648;&#x631;&#x62A; &#x647;&#x645;&#x62E;&#x648;&#x627;&#x646;&#x6CC; &#x627;&#x6CC;&#x645;&#x6CC;&#x644; &#x648;&#x627;&#x631;&#x62F; &#x634;&#x62F;&#x647; &#x628;&#x627; &#x627;&#x6CC;&#x645;&#x6CC;&#x644; &#x62B;&#x628;&#x62A; &#x634;&#x62F;&#x647; &#x62F;&#x631; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x631;&#x627; &#x62F;&#x631; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x627;&#x647;&#x631;&#x627;&#x632; &#x647;&#x648;&#x6CC;&#x62A; &#x62A;&#x63A;&#x6CC;&#x6CC;&#x631; &#x645;&#x6CC;&#x62F;&#x647;&#x62F;
 * @param {!object} request
 * @param {!string} request.data.type &#x646;&#x648;&#x639; &#x6A9;&#x627;&#x631;&#x628;&#x631;
 * @param {!string} request.data.nationalCode &#x6A9;&#x62F;&#x645;&#x644;&#x6CC;
 * @param {!string} request.data.email &#x627;&#x6CC;&#x645;&#x6CC;&#x644;
 * @param {!string} request.data.newPassword &#x631;&#x645;&#x632;&#x639;&#x628;&#x648;&#x631; &#x62C;&#x62F;&#x6CC;&#x62F;
 * @param {!object} response
 * @return {!object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 */
exports.changePass = function (request, response) {

    console.log(&apos;-----------changePass called-----------&apos;)

    let self = this;
    let profile = self._profile
    let auth = self._auth

    request.session.get([&apos;samadUsername&apos;, &apos;roles&apos;], function (err, result) {
        if (err) {
            console.log(err.data.message)
            response.sendFail(err.data.message)
        } else {

            profile.getRealProfiles(request.data.nationalCode, [], &apos;intern_6&apos;, {
                &apos;request-id&apos;: uuid(),
                userIp: &apos;127.0.0.1&apos;
            }).then(function (res) {
                console.log(res.data.real[0].email)
                if (request.data.email == res.data.real[0].email) {
                    console.log(&apos;editable&apos;)


                    auth.editUser({username: result.samadUsername}, {password: request.data.newPassword}, &apos;intern_6&apos;, {
                        &apos;request-id&apos;: uuid(),
                        userIp: &apos;127.0.0.1&apos;
                    })
                        .then(function (res) {
                            console.log(res)
                            response.sendOk(&apos;&#x631;&#x645;&#x632; &#x639;&#x628;&#x648;&#x631; &#x628;&#x627; &#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x62A;&#x63A;&#x6CC;&#x6CC;&#x631; &#x6A9;&#x631;&#x62F;.&apos;)
                        })
                        .fail(function (err) {
                            console.log(err)
                            response.sendFail(&apos;&#x62E;&#x637;&#x627; &#x62F;&#x631; &#x62A;&#x63A;&#x6CC;&#x6CC;&#x631; &#x631;&#x645;&#x632; &#x639;&#x628;&#x648;&#x631;&apos;)
                        });

                } else {
                    response.sendFail(&apos;&#x627;&#x6CC;&#x645;&#x6CC;&#x644; &#x635;&#x62D;&#x6CC;&#x62D; &#x646;&#x6CC;&#x633;&#x62A;!&apos;)
                }
            })
                .catch(function (error) {
                    response.sendFail(&apos;&#x6A9;&#x62F; &#x645;&#x644;&#x6CC; &#x645;&#x639;&#x62A;&#x628;&#x631; &#x646;&#x645;&#x6CC;&#x200C;&#x628;&#x627;&#x634;&#x62F;! &#x62F;&#x627;&#x62F;&#x647;&#x200C;&#x647;&#x627;&#x6CC; &#x648;&#x631;&#x648;&#x62F;&#x6CC; &#x646;&#x627;&#x645;&#x639;&#x62A;&#x628;&#x631;&#x646;&#x62F;&apos;)
                })


        }
    })
}

//----------------------PROFILE----------------------
/**
 * @summary &#x62F;&#x631;&#x6CC;&#x627;&#x641;&#x62A; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644;
 * @description &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x628;&#x627; &#x6A9;&#x62F;&#x645;&#x644;&#x6CC; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x645;&#x634;&#x62E;&#x635;&#x627;&#x62A; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x648;&#x6CC; &#x631;&#x627; &#x627;&#x632; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x62F;&#x631;&#x6CC;&#x627;&#x641;&#x62A; &#x6A9;&#x631;&#x62F;&#x647; &#x648; &#x646;&#x645;&#x627;&#x6CC;&#x634; &#x645;&#x6CC;&#x62F;&#x647;&#x62F;
 * @param {!object} request
 * @param {!integer} request.data.nationalCode &#x6A9;&#x62F;&#x645;&#x644;&#x6CC;
 * @return {!object} response
 */
exports.getProfile = function (request, response) {
    console.log(request.data)
    console.log(&apos;------------getProfile called------------&apos;)
    let self = this;
    let profile = self._profile


    request.session.get([&apos;samadUsername&apos;], function (err, result) {

        profile.getProfileByUniqueKey(result.samadUsername, [&apos;idNumber&apos;], null, {
            &apos;request-id&apos;: uuid(),
            userIp: &apos;127.0.0.1&apos;
        })
            .then(function (result) {

                self._profile.getRealProfiles(result.data.real[0].idNumber, [], &apos;intern_6&apos;, {
                    &apos;request-id&apos;: uuid(),
                    userIp: &apos;127.0.0.1&apos;
                }).then(function (res) {
                    response.sendOk(res.data.real)
                })
                    .catch(function (err) {
                        response.sendFail(err)
                    })

            })
    })


}
/**
 * @summary &#x648;&#x6CC;&#x631;&#x627;&#x6CC;&#x634; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644;
 * @description &#x627;&#x6CC;&#x646; &#x645;&#x62A;&#x62F; &#x628;&#x627; &#x6A9;&#x62F;&#x645;&#x644;&#x6CC; &#x6A9;&#x627;&#x631;&#x628;&#x631; &#x645;&#x634;&#x62E;&#x635;&#x627;&#x62A; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x648;&#x6CC; &#x631;&#x627; &#x627;&#x632; &#x633;&#x6CC;&#x633;&#x62A;&#x645; &#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x62F;&#x631;&#x6CC;&#x627;&#x641;&#x62A; &#x6A9;&#x631;&#x62F;&#x647; &#x648; &#x646;&#x645;&#x627;&#x6CC;&#x634; &#x645;&#x6CC;&#x62F;&#x647;&#x62F;
 * @param {!object} request
 * @param {!string} request.data.type &#x646;&#x648;&#x639; &#x6A9;&#x627;&#x631;&#x628;&#x631;
 * @param {!string} request.data.nationalCode &#x6A9;&#x62F;&#x645;&#x644;&#x6CC;
 * @param {?object[]} &#x62F;&#x627;&#x62F;&#x647; &#x647;&#x627;&#x6CC; &#x627;&#x62E;&#x62A;&#x6CC;&#x627;&#x631;&#x6CC; &#x646;&#x638;&#x6CC;&#x631; firstName-lastName-gender-maritalStatus-fatherName-identityNumber &#x648; ...
 * @return{!object} &#x648;&#x636;&#x639;&#x6CC;&#x62A; &#x627;&#x646;&#x62C;&#x627;&#x645; &#x639;&#x645;&#x644;&#x6CC;&#x627;&#x62A;
 */
exports.editProfile = function (request, response) {
    console.log(&apos;---------editProfile called------------&apos;)
    let self = this;
    let profile = self._profile

    request.session.get([&apos;samadUsername&apos;], function (err, result) {

        profile.getProfileByUniqueKey(result.samadUsername, [&apos;idNumber&apos;, &apos;type&apos;], null, {
            &apos;request-id&apos;: uuid(),
            userIp: &apos;127.0.0.1&apos;
        })
            .then(function (result) {
                console.log(result.data.real[0])
                let data = {
                    &quot;type&quot;: result.data.real[0].type,
                    &quot;idNumber&quot;: result.data.real[0].idNumber.toString(),
                }

                self._profile.editProfile(data, {&apos;request-id&apos;: uuid(), userIp: &apos;127.0.0.1&apos;})
                    .then(function (res) {
                        console.log(JSON.stringify(result.data.real[0]))
                        response.sendOk(&apos;&#x67E;&#x631;&#x648;&#x641;&#x627;&#x6CC;&#x644; &#x628;&#x627;&#x645;&#x648;&#x641;&#x642;&#x6CC;&#x62A; &#x648;&#x6CC;&#x631;&#x627;&#x6CC;&#x634; &#x634;&#x62F;.&apos;)
                    })
                    .catch(function (err) {
                        response.sendFail(err.message)
                    })

            })
    })


}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="module.partUserProfile.httpHandlers.html">httpHandlers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#changePass">changePass</a></li><li><a href="global.html#editProfile">editProfile</a></li><li><a href="global.html#employeeService">employeeService</a></li><li><a href="global.html#getProfile">getProfile</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#setSessionByRole">setSessionByRole</a></li><li><a href="global.html#signUp">signUp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun May 03 2020 22:50:33 GMT+0430 (Iran Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>


</body></html>